<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Index.css">
    <!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="axios.js"></script> -->
    <title>Document</title>
</head>
<body>
    <h1>Personas</h1>
    <hr>
        <form id="myForm" method="POST">
            <div>
                <label>Id:  </label>
                <input type="text" id="textId"/>
                <label>Nombre:  </label>
                <input type="text" id="textNombre"/>
                <label>Edad:  </label>
                <input type="text" id="textEdad"/><br><br>
            </div>
            <div>
                <button type="submitAdd" id="buttonIngresar">Ingresar</button>
                <button type="submitUpdate" id="buttonActualizar">Actualizar</button>
                <button type="submitDelete" id="buttonEliminar">Eliminar</button>
            </div>
        </form>
   
    <hr>
    <div id="titulo">
        <div>Id</div>
        <div>Nombre</div>
        <div>Edad</div>
    </div>
    <div id="divLista" class="grid-container">
        
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>
</body>
</html>

<script type="text/javascript">    
    var url="https://localhost:44338/Api/Persona";

        //Mostrar datos por Get
     

       
                fetch(url)
                .then(response => response.json())
                .then(Data => agregarElementos(Data))
     
        
         function agregarElementos(Data) {
             var foo = Data.map((datos) => '<div class="grid-container">' + '<div>' + datos.id + '</div>' +  ' '  
                                            + '<div>' + datos.nombre + '</div>'+ ' ' 
                                            + '<div>' + datos.edad  + '</div>' + '</div>' +'<hr>')
            
             document.getElementById("divLista").innerHTML = foo;
            //  window.loca.reload();  
           
        }
        
       

        Actualizar = () =>{
            window.loca.reload();
        }


       

        //Ingresar datos por POST
 
    var form = document.getElementById('myForm');
    var agregar = document.getElementById("buttonIngresar");

    agregar.addEventListener('click',e =>{
        e.preventDefault();
        let peticion;
        if (window.XMLHttpRequest) peticion = new XMLHttpRequest();
        else peticion = new ActiveXObject("Microsoft.XMLHTTP");

        let respuesta;
        if (peticion.status == 200 || peticion.status == 201) respuesta = peticion.response;
        else respuesta = "Lo siento, no se ha encontrado el producto";
       
                           

        
        peticion.open("POST",url);
         
        peticion.setRequestHeader("Content-type","application/json;charset=UTF8");

        peticion.send(JSON.stringify(
            {
                "nombre":  document.getElementById("textNombre").value,
                "edad": parseInt(document.getElementById("textEdad").value)
            }
        ))
    })

 

   let actualizar = document.getElementById("buttonActualizar");
// generamos el metodo put para actualizar
   actualizar.addEventListener('click',e => {
     e.preventDefault();

        let data = {
                Id:parseInt(document.getElementById("textId").value),
                Nombre:document.getElementById("textNombre").value,
                Edad:parseInt(document.getElementById("textEdad").value)
        };

        let peticion;
        if (window.XMLHttpRequest) peticion = new XMLHttpRequest();
        else peticion = new ActiveXObject("Microsoft.XMLHTTP");

        let respuesta;
        if (peticion.status == 200 || peticion.status == 201) respuesta = peticion.response;
        else respuesta = "Lo siento, no se ha encontrado el producto";

        let json = JSON.stringify(data);
        peticion.open("PUT",url,true);
        peticion.setRequestHeader('Content-type','application/json;charset=UTF8');

        peticion.send(json);
        Actualizar();
   })
    

   let eliminar = document.getElementById("buttonEliminar");

   eliminar.addEventListener('click',e => {
         e.preventDefault();


        
                        
                let data = {
                        Id:parseInt(document.getElementById("textId").value),
                        Nombre:document.getElementById("textNombre").value,
                        Edad:parseInt(document.getElementById("textEdad").value)
                };
                

                fetch(url)
                        .then(response => response.json())
                        .then(e => {
                            for (const value of e) {
                                console.log(value.id);
                                if (value.id===data.Id) {
                                    var Nombre = value.nombre;
                                    var Edad = value.edad;

                                    fetch(url,{
                                        method:'DELETE',
                                        headers: {'Content-Type': 'application/json',
                                                    'Accept': 'application/json'},
                                        body:JSON.stringify({
                                            "Id": data.Id,
                                            "Nombre": Nombre,
                                            "Edad": Edad
                                        })
                                    }).then((response) => response.json())
                                    .then((json) => console.log(json))
                                
                                    document.location.reload();
                                    
                                }
                            }
                        
                        })            
        


         
        
   })
    


</script>